---
type: landing
directory: developer-docs/installation/
title: Upgrading Databases
page_title: Upgrading Databases
description: Upgrading Databases
keywords: Upgrading Databases
published: true
allowSearch: true
---
## Overview 
This page guides you through the process of planning and executing Sunbird Database upgrades. In addition, this page provides information about various upgrade scenarios,such as initialization parameter changes, pros and cons.

## Introduction

The process of upgrading you cassandra installation is as follows:
  
  1. Build Process
  2. Deployment Process
  3. Commisioning Scenarios 
  4. Necessary instructions 
  5. Running the Script

## Build

* Create a `Cassandra_Build` Jenkins job. 
* Navigate to `sunbird-utils/cassandra-migration` directory and run `mvn clean install -DskipTests`

Artifact `cassandra-migration-0.0.1-SNAPSHOT-jar-with-dependencies.jar` is created inside `sunbird-utils/cassandra-migration/target` directory.

## Deployment

* Create a `Cassandra_Deploy` Jenkins job. 
* Copy the artifact `cassandra-migration-0.0.1-SNAPSHOT-jar-with-dependencies.jar`  from  `Cassandra_Build` to `Cassandra_Deploy`     
  Jenkins job.
* Copy the jar file to the remote Cassandra machine. 
* Set the following enivronment variables on the Cassandra host:

<pre>

  a. sunbird_cassandra_host: (in case of multiple host provide the value comma separated) 
  b. sunbird_cassandra_port: 
  c. sunbird_cassandra_username: (Optional) 
  d. sunbird_cassandra_password: (optional) 
  e. sunbird_cassandra_keyspace: (for ex: sunbird)

</pre>

Ensure that the Cassandra keyspace is already created; if not, executing the following command will create Cassandra Keyspaces:

<pre>

Run java -cp "cassandra-migration-0.0.1-SNAPSHOT-jar-with-dependencies.jar com.contrastsecurity.cassandra.migration.utils.MigrationScriptEntryPoint` on your remote cassandra machine.

</pre>

## Upgrading your Cassandra installation 

### Prerequisites 

The upgrade option has been implemented in version 1.4. If you are running a release version less then 1.4, ensure that your schemas and tables are as per version 1.3 atleast.

The following scenarios will guide you further in upgrade process: 

### Running a release version lesser than 1.4

In case you are running a version lesser than 1.4, ensure that you execute the following command.
<pre>
Run the default `cassandra.cql` file  \\ which will create schema and tables until release-1.3. 
</pre>
This ensures that your schemas and tables fall in line with upgradtion requirements. 
**Note:** Ignore the errors, if you encounter any while executing the command, These errors are fixed in later releases. 

### Running a release version greater than or equal to release-1.4 

Since, the schemas and tables fall inline with the upgrade requirements. You can proceed with 
the following upgrade process:  

1) Setup the cassandra migration across sunbird. 
2) Create deploy scripts for the sunbird clients.
3) Convert the `cassandra.cql` script idempotent.
4) Create cassandra backup and restore scripts.


* Script location is : **resources/db/migration/cassandra**
* Script file should be in this format : **V{major_version_no}.{minor_version_no}_{filename}.cql**

**Pros:**

1. it will pick all the files whose format is **V{major_version_no}.{minor_version_no}_{filename}.cql** under **resources/db/migration/cassandra**  location and run it. it's easy to manage the migration

**Cons:**
1. if any one file fail then it won't run further unless we fixed the issues manually.
2. after fixing file ,we need to delete false entry under cassandra_migration_version table , this table will be auto generated by cassandra migration.

  ```javascript 
   Table structure ----
    version text PRIMARY KEY,
    checksum int,
    description text,
    execution_time int,
    installed_by text,
    installed_on timestamp,
    installed_rank int,
    script text,
    success boolean,
    type text,
    version_rank int
   ```

3.  it's supporting only following format
      V{major_version_no}.{minor_version_no}_{filename}.cql
    
    V1.0_cassandra.cql // correct file format

    V1.0.1_cassandra.cql // incorrect file format 

