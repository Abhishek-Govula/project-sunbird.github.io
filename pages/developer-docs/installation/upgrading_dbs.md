---
type: landing
directory: developer-docs/installation/
title: Upgrading Databases
page_title: Upgrading Databases
description: Upgrading Databases
keywords: Upgrading Databases
published: true
allowSearch: true
---
## Introduction
>  Process to manage cassandra migration.
  1. [Build Process](#build)
  2. [Deploy Process](#deploy)
  3. [Sunbird Users](#users)
  4. [Required Action](#action)
  5. [Scripts Details](#script)

## build:
* Create a `Cassandra_Build` Jenkins job. 
* Move to `sunbird-utils/cassandra-migration` directory  & run `mvn clean install -DskipTests` .
* Artifact `cassandra-migration-0.0.1-SNAPSHOT-jar-with-dependencies.jar` gets created inside `sunbird-utils/cassandra-migration/target` directory.

## deploy:
* Create a `Cassandra_Deploy` Jenkins job. Copy the artifact `cassandra-migration-0.0.1-SNAPSHOT-jar-with-dependencies.jar`  from  `Cassandra_Build` to `Cassandra_Deploy` Jenkins job.
* Copy the above jar file to the remote cassandra machine. 
* Set the below enivronment variables on cassandra host:
```
a. sunbird_cassandra_host: (in case of multiple host provide the value comma separated) 
b. sunbird_cassandra_port: 
c. sunbird_cassandra_username: (Optional) 
d. sunbird_cassandra_password: (optional) 
e. sunbird_cassandra_keyspace: (for ex: sunbird)
```

* Before running the command make sure, cassandra keyspace is already created.

* Run `java -cp "cassandra-migration-0.0.1-SNAPSHOT-jar-with-dependencies.jar" com.contrastsecurity.cassandra.migration.utils.MigrationScriptEntryPoint` on the remote cassandra machine.

## users

## Scenario-1: For the fresh setup 
* As cassandra migration is implemented in release-1.4 before following above steps, Run the default `cassandra.cql` file, which will create schema and tables until release-1.3. Cassandra.cql might through some errors which can ignored(should be fixed in later releases). 

## Scenario-2: User having release less than release-1.4 (For ex: moving from release-1.2 to release-1.4)
* Follow the similar steps as scenorio-1, restore all cassandra data if a new cassandra is provisioned.

## secnario-3 : User having release greater than equal to release-1.4 
* Run cassandra migration only, no need to run `cassandra.cql` file. 

## action:
1) Setup the cassandra migration across sunbird and ntp. 
2) Create deploy scripts for the sunbird clients.
3) Convert the `cassandra.cql` script idempotent.
4) Create cassandra backup and restore scripts.


## script.
* Script location is : **resources/db/migration/cassandra**
* Script file should be in this format : **V{major_version_no}.{minor_version_no}_{filename}.cql**

**Pros:**

1. it will pick all the files whose format is **V{major_version_no}.{minor_version_no}_{filename}.cql** under **resources/db/migration/cassandra**  location and run it. it's easy to manage the migration

**Cons:**
1. if any one file fail then it won't run further unless we fixed the issues manually.
2. after fixing file ,we need to delete false entry under cassandra_migration_version table , this table will be auto generated by cassandra migration.

  ```javascript 
   Table structure ----
    version text PRIMARY KEY,
    checksum int,
    description text,
    execution_time int,
    installed_by text,
    installed_on timestamp,
    installed_rank int,
    script text,
    success boolean,
    type text,
    version_rank int
   ```

3.  it's supporting only following format
      V{major_version_no}.{minor_version_no}_{filename}.cql
    
    V1.0_cassandra.cql // correct file format

    V1.0.1_cassandra.cql // incorrect file format 

