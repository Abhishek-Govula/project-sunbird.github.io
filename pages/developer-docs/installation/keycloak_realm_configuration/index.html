<h2 id="access-keycloak-administration">Access Keycloak Administration</h2>

<p>Assuming that you have set up Sunbird on sunbird.example.com, You can open Keycloak administration panel simply by navigating to <strong>https://sunbird.example.com/auth/admin</strong></p>

<h2 id="import-realm">Import Realm</h2>

<ul>
  <li>
    <p>To simplify the configuration, Sunbird provides a ready to use realm that can be readily imported and used. Download the realm <a href="https://raw.githubusercontent.com/project-sunbird/project-sunbird.github.io/dev/pages/developer-docs/installation/other_files/keycloak-realm.json">here</a>.</p>
  </li>
  <li>
    <p>To import the realm, use the ‘Add realm’ button as shown in the following screens.</p>
  </li>
</ul>

<p><a target="_blank" href="pages/developer-docs/installation/images/keycloack-add-realm.png">
        <img src="pages/developer-docs/installation/images/keycloack-add-realm.png" alt="Keycloak realm" class="plugin center" width="50%" />
      </a></p>

<p><a target="_blank" href="pages/developer-docs/installation/images/keycloak-choose-json.png">
        <img src="pages/developer-docs/installation/images/keycloak-choose-json.png" alt="choose keycloak json" class="plugin center" width="50%" />
      </a></p>

<ul>
  <li>On the import screen, choose the json file and click ‘Create’.</li>
</ul>

<p><a target="_blank" href="pages/developer-docs/installation/images/keycloak-import-realm.png">
        <img src="pages/developer-docs/installation/images/keycloak-import-realm.png" alt="Keycloak import realm" class="plugin center" width="50%" />
      </a></p>

<p>Once the realm is imported ensure the realm is set as active realm before proceeding with the rest of the configuration.</p>

<h2 id="create-user-to-access-user-management-api">Create User to Access User Management API</h2>

<p>Navigate to Manage, then to Users and create a new user.</p>

<ul>
  <li>
    <p>Enter the username as <code>user-manager</code>, set the email to be verified and save.</p>
  </li>
  <li>
    <p>Assign a password to this user.</p>
  </li>
  <li>
    <p>Update client roles under role mappings to ensure that this user has the <code>manage-users</code>, <code>query-users</code>, <code>query-groups</code> and <code>view-users</code> permissions.</p>
  </li>
</ul>

<p><strong>Note:</strong> Refer to the following screenshot for reference configuration.</p>

<p><a target="_blank" href="pages/developer-docs/installation/images/keycloak-add-user-manager.png">
        <img src="pages/developer-docs/installation/images/keycloak-add-user-manager.png" alt="Keycloak use management" class="plugin center" width="50%" />
      </a></p>

<ul>
  <li>Use corresponding username and password values for this user as the values for <code>sunbird_sso_username</code> and <code>sunbird_sso_password</code> in the configuration.</li>
</ul>

<h2 id="update-client--secrets">Update Client &amp; Secrets</h2>

<p>Navigate to Clients and make the following changes to each of the clients.</p>

<p><strong>Note:</strong> Modify only the clients listed below. You do not need to modify the settings for other clients.</p>

<h3 id="account-broker-realm-management">Account, broker, realm-management</h3>

<p>Go to the Credentials tab and regenerate the Secret and Registration Access Token. Make a note of both as they will be required at later stage.</p>

<h3 id="android">Android</h3>

<p>Change the Root URL to <code>https://sunbird.example.com</code>
Add a Valid Redirect URI <code>https://sunbird.example.com/oauth2callback</code></p>

<h3 id="portal">Portal</h3>

<p>Change the Root URL to <code>https://sunbird.example.com</code>
Add Valid Redirect URIs <code>https://sunbird.example.com/private/*</code> and <code>https://sunbird.example.com/</code></p>

<h3 id="trampoline">Trampoline</h3>

<p>Change the Root URL to <code>https://sunbird.example.com</code>
Go to the Credentials tab and regenerate the Secret and Registration Access Token. Use the secret as the value for the <code>sunbird_trampoline_secret</code> configuration.</p>

<h2 id="smtp-configuration">SMTP Configuration</h2>

<p>It is necessary to configure email for smooth working of the password reset functionality and user management workflows. 
Navigate to <code>Realm Settings &gt; Email</code>. Enter the SMTP credentials and click the Test Connection button to verify that the SMTP connection is working.</p>
