<h2 id="overview">Overview</h2>
<p>The main purpose of <a href="https://github.com/project-sunbird/open-saber/wiki">Open Saber</a> is to serve as an electronic registry for entities such as  teacher registry, doctor registry etc. Open saber can be used by Sunbird adopters to store custom information about their organization users, user profile data extensions, organisation data extensions etc.</p>

<h3 id="customization">Customization</h3>
<p>Open Saber maintains information in <a href="https://www.w3.org/RDF/">RDF</a> graph data format. <a href="https://shex.io/">SHEX</a> is used to define the schema of data stored in Open Saber. The SHEX schema definition can consist of one or more entities e.g. user, organisation etc. whose information can be stored within Open Saber.</p>

<p>Currently all interactions with Open Saber is in <a href="https://json-ld.org/">JSON-LD</a> format while Sunbird LMS APIs are in JSON format. A java library (Open Saber Client) is available for transforming between JSON-LD and JSON formats. Additionally, Sunbird provides a java library for bridging between Open Saber equivalent JSON and Sunbird API specified JSON format.</p>

<p>To support customization of an entity within Sunbird, the following definitions are required:</p>

<ol>
  <li>
    <p>Definition of the entity using SHEX (Open Saber). For more details refer <a href="https://github.com/project-sunbird/open-saber/wiki">Open Saber</a></p>
  </li>
  <li>
    <p>Define mapping to transform between JSON-LD and JSON format (Open Saber Client). For more details refer <a href="https://github.com/project-sunbird/open-saber/wiki">Open Saber</a></p>
  </li>
  <li>
    <p>Define mapping to transform between Open Saber Client JSON and Sunbird JSON format (Sunbird Open Saber Bridge). This includes updation of following files within <a href="https://github.com/project-sunbird/sunbird-open-saber-bridge">Sunbird Open Saber Bridge</a></p>
  </li>
</ol>

<p>a) <strong>registry-user-write-mapping.conf</strong>: Configuration to map Sunbird User Create and Update API request JSON format for required extensions (i.e. custom fields) into Open Saber Client JSON format</p>

<p>Currently Sunbird only supports customisation of users</p>

<p>Add configuration for every custom field in below format. This configuration definition is as per typesafe format</p>

<pre><code>
&lt;customType&gt; {
    &lt;customFieldName&gt; {
        &lt;propertyName&gt;: &lt;propertyValue&gt;
        ...
    }
}

</code></pre>

<table>
  <thead>
    <tr>
      <th>Property Name</th>
      <th>Field Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>fromFieldName</td>
      <td>Optional</td>
      <td>Field name which identifies input of transformation. If not specified, _<customFieldName>_ is used</customFieldName></td>
    </tr>
    <tr>
      <td>toFieldName</td>
      <td>Mandatory</td>
      <td>Field name which identifies output of transformation</td>
    </tr>
    <tr>
      <td>fromType</td>
      <td>Mandatory</td>
      <td>Type of from field name</td>
    </tr>
    <tr>
      <td>toType</td>
      <td>Mandatory</td>
      <td>Type of to field name</td>
    </tr>
    <tr>
      <td>fromDateFormat</td>
      <td>Optional</td>
      <td>Date format of input if from field type is DateString</td>
    </tr>
    <tr>
      <td>toDateFormat</td>
      <td>Optional</td>
      <td>Date format of output if to field type is DateString</td>
    </tr>
    <tr>
      <td>filters</td>
      <td>Optional</td>
      <td>Filter for selecting an element to transform from an input of type _List<T>_</T></td>
    </tr>
    <tr>
      <td>filterField</td>
      <td>Optional</td>
      <td>Field to use from selected element in transformation</td>
    </tr>
  </tbody>
</table>

<p><strong>Note</strong>:</p>

<ul>
  <li>
    <p>Supported types are <em>Integer</em>, <em>Double</em>, <em>Long</em>, <em>Boolean</em>, <em>String</em>, <em>DateString</em> and _List<T>_</T></p>
  </li>
  <li>
    <p>In _List<T>_ type, _T_ can be a simple type (e.g. _String_) or a custom type. A custom type can be defined in the configuration</T></p>
  </li>
  <li>
    <p><em>filters</em> is applicable only if <em>fromType</em> is _List<T>_ and _toType_ is other than list type</T></p>
  </li>
  <li>
    <p><em>filterField</em> is applicable only if <em>fromType</em> is _List<T> and _filters_ is specified</T></p>
  </li>
  <li>
    <p><em>filters</em> has the following format. This filter can be used to select an element having specified field name with specified value</p>
  </li>
</ul>

<pre><code>[{field = &lt;fieldName&gt;, values = [&lt;valueName&gt;]}]
</code></pre>

<p>b) <strong>registry-user-read-mapping.conf</strong>: Configuration to map Open Saber Client response JSON format for required extensions into Sunbird User Read API JSON format 
The configuration format for read mapping is similar to write mapping. The difference between read and write mapping is due to the input. In case of read, the input is Open Saber Client response JSON whereas in case of write, the input is Sunbird API request JSON format
c) <strong>registry-user-enums-mapping.conf</strong>: Configuration which defines enumerations required for mapping between Sunbird User API JSON format and Open Saber Client JSON format
The configuration format for enums is as given below:</p>

<pre><code>enums {
	&lt;customEnumName1&gt; {
		"&lt;sunbirdEnumValue1.1&gt;" = "&lt;openSaberEnumValue1.1&gt;"
		"&lt;sunbirdEnumValue1.2&gt;" = "&lt;openSaberEnumValue1.2&gt;"
		...
	}
	&lt;customEnumName2&gt; {
		"&lt;sunbirdEnumValue2.1&gt;" = "&lt;openSaberEnumValue2.1&gt;"
		"&lt;sunbirdEnumValue2.2&gt;" = "&lt;openSaberEnumValue2.2&gt;"
		...
	}
}
</code></pre>

<p>Listed are some examples to illustrate configuration of user customisation.
<strong>Example 1</strong>: Define configuration for a user with a custom field <em>schoolCode</em> of simple type</p>

<p><strong>registry-user-write-mapping.conf</strong></p>

<pre><code>user {
	schoolCode {
		toFieldName	= "teacher.schoolCode"
		fromType	= "String"
		toType		= "String"
	}
}
</code></pre>

<p><strong>registry-user-read-mapping.conf</strong></p>

<pre><code>teacher {
	schoolCode {
		toFieldName	= "schoolCode"
		fromType	= "String"
		toType		= "String"
	}
}
</code></pre>

<p><strong>Sunbird API JSON format</strong></p>

<pre><code>{
	"schoolCode": "KV101"
}
</code></pre>

<p><strong>Open Saber Client JSON format</strong></p>

<pre><code>{
    "teacher": {
    	"schoolCode": "KV101"
    }
}
</code></pre>

<p><strong>Example 2</strong>: Define configuration for a user with a custom field <em>highestAcademicQualification</em> of _List<T>_ type, where _T_ is a simple type</T></p>

<p><strong>registry-user-write-mapping.conf</strong></p>

<pre><code>user {
	highestAcademicQualification {
		toFieldName	= "teacher.highestAcademicQualification"
		fromType	= "List&lt;String&gt;"
		toType		= "List&lt;String&gt;"
		enum		= "academicQualificationEnum"
	}
}
</code></pre>

<p><strong>registry-user-read-mapping.conf</strong></p>

<pre><code>teacher {
	highestAcademicQualification {
		toFieldName	= "highestAcademicQualification"
		fromType	= "List&lt;String&gt;"
		toType		= "List&lt;String&gt;"
		enum		= "academicQualificationEnum"
	}
}
</code></pre>

<p><strong>registry-user-enums-mapping.conf</strong></p>

<pre><code>enums {
    academicQualificationEnum {
	    "Below Secondary"	= "BelowSecondary"
	    "Secondary"			= "Secondary"
	    "Higher Secondary"	= "HigherSecondary"
	    "Graduate"			= "Graduate"
	    "PostGraduate"		= "PostGraduate"
	    "MPhil"				= "MPhil"
	    "Doctoral"			= "Doctoral"
	    "Post-Doctoral"		= "PostDoctoral"
	}
}
</code></pre>

<p><strong>Sunbird API JSON format</strong></p>

<pre><code>{
	"highestAcademicQualification": ["PostGraduate", "Higher Secondary"]
}
</code></pre>

<p><strong>Open Saber Client JSON format</strong>
~~~
{
    “teacher”: {
    	“highestAcademicQualification”: [“PostGraduate”, “HigherSecondary”]
    }
}
~~~</p>

<p><strong>Example 3</strong>: Define configuration for a user with custom field <em>classSubjectTaught</em> of _List<T>_ type, where _T_ is a custom type.</T></p>

<p><strong>registry-user-write-mapping.conf</strong></p>

<pre><code>user {
	classSubjectTaught {
		toFieldName	= "teacher.teachingExperience"
		fromType	= "List&lt;classSubjectType&gt;"
		toType		= "List&lt;T&gt;"
	}
}
classSubjectType {
	classes {
		toFieldName	= "classesTaught"
		fromType	= "String"
		toType		= "String"
		enum		= "classEnum"
	}
	subjects {
		toFieldName	= "subjectsTaught"
		fromType	= "List&lt;String&gt;"
		toType		= "List&lt;String&gt;"
		enum		= "subjectsEnum"
	}
}
</code></pre>

<p><strong>registry-user-read-mapping.conf</strong></p>

<pre><code>teacher {
	teachingExperience {
		toFieldName	= "classSubjectTaught"
		fromType	= "List&lt;classSubjectTaughtType&gt;"
		toType		= "List&lt;T&gt;"
	}
}
classSubjectTaughtType {
	classesTaught {
		toFieldName	= "classes"
		fromType	= "String"
		toType		= "String"
		enum		= "classEnum"
	}
	subjectsTaught {
		toFieldName	= "subjects"
		fromType	= "List&lt;String&gt;"
		toType		= "List&lt;String&gt;"
		enum		= "subjectEnum"
	}
}
</code></pre>

<p><strong>registry-user-enums-mapping.conf</strong></p>

<pre><code>enums {
	classEnum {
		"Class 1"	= "Class1"
		"Class 2"	= "Class2"
		"Class 3"	= "Class3"
	}
    subjectEnum {
		"Accountancy"		= "Accountancy"
		"Biology"			= "Biology"
		"Chemistry"			= "Chemistry"
		"Computer Science"	= "ComputerScience"
	}	
}
</code></pre>

<p><strong>Sunbird API JSON format</strong></p>

<pre><code>{
	"classSubjectTaught": [{
                "classes": "Class 1",
                "subjects": ["English", "Foreign Language"]
            }, {
                "classes": "Class 8",
                "subjects": ["Fine Arts", "Foreign Language"]
            }
        ]
}
</code></pre>

<p><strong>Open Saber Client JSON format</strong></p>

<pre><code>{
    "teacher": {
    	"classSubjectTaught": [{
                "classes": "Class 1",
                "subjects": ["English", "ForeignLanguage"]
            }, {
                "classes": "Class 8",
                "subjects": ["Fine Arts", "ForeignLanguage"]
            }
        ]
    }
}
</code></pre>

<p><strong>Example 4</strong>: Define configuration for a user with custom field <em>serviceJoiningDate</em> of <em>DateString</em> type.</p>

<p><strong>registry-user-write-mapping.conf</strong></p>

<pre><code>user {
	serviceJoiningDate {
		toFieldName	    = "teacher.serviceJoiningDate"
		fromType	    = "DateString",
		toType		    = "DateString"
		fromDateFormat  = "yyyy-MM-dd"
		toDateFormat    = "yyyy-MM-dd"
	}
}
</code></pre>

<p><strong>registry-user-read-mapping.conf</strong></p>

<pre><code>teacher {
	serviceJoiningDate {
		toFieldName	    = "serviceJoiningDate"
		fromType	    = "DateString",
		toType		    = "DateString"
		fromDateFormat  = "yyyy-MM-dd"
		toDateFormat    = "yyyy-MM-dd"
	}
}
</code></pre>

<p><strong>Sunbird API JSON format</strong></p>

<pre><code>{
	"serviceJoiningDate": "2015-04-07"
}
</code></pre>

<p><strong>Open Saber Client JSON format</strong></p>

<pre><code>{
    "teacher": {
    	"serviceJoiningDate": "2015-04-07"
    }
}
</code></pre>

<p><strong>Example 5</strong>: Define configuration for a user with custom field <em>teacherId</em> of <em>String</em> type which is set based on a filter applied on an input _List<T>_ type.</T></p>

<p><strong>registry-user-write-mapping.conf</strong></p>

<pre><code>user {
	externalIds {
		toFieldName = "teacher.teacherId"
		fromType	= "List&lt;T&gt;"
		toType		= "String"
		filters		= [{field = "provider", values = ["SK"]}]
		filterField = "id"
	}
}
</code></pre>

<p><strong>Sunbird API JSON format</strong></p>

<pre><code>{
	"externalIds": [{
	    "id": "12345",
	    "idType": "UID",
	    "provider": "SK",
	}]
}
</code></pre>

<p><strong>Open Saber Client JSON format</strong></p>

<pre><code>{
    "teacher": {
    	"teacherId": "12345"
    }
}
</code></pre>
