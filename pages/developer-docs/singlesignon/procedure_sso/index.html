<h2 id="procedure-to-onboard-organizations">Procedure to Onboard Organizations</h2>

<div>
<table class="auto">
<thead>
<tr>
	<th>Step</th>
	<th>Instruction</th>
</tr>
</thead>
<tbody>
<tr>
	<td>1.</td>
	<td>Create a tenant organization </td>
</tr>
<tr>
	<td>2.</td>
	<td>Generate the RSA private and public key pair </td>
</tr>
<tr>
	<td>3.</td>
	<td>Get the public key registered in production </td>
</tr>
<tr>
	<td>4.</td>
	<td>Create organizations, and users, and register</td>
</tr>
<tr>
	<td>5.</td>
	<td>Single Sign-On with Sunbird</td>
</tr>
</tbody>
</table>


</div>

<h2 id="tokens">Tokens</h2>

<p>Tokens are used to authenticate users across Sunbird instances, networks or applications via SSO (Single Sign-on). The JWT provided to the auto-login endpoint must contain the following fields (also known as claims) in its payload.</p>

<ul>
  <li>
    <p><strong>jti:</strong> a unique ID of the token. This can be any unique string generated by the sender</p>
  </li>
  <li>
    <p><strong>iss:</strong> the issuer of the JWT. This must be the ID of the registered client</p>
  </li>
  <li>
    <p><strong>sub:</strong> the subject of the token. This must be the user ID of the person who is signed  in</p>
  </li>
  <li>
    <p><strong>aud:</strong> the consumer of the token. This is the site or instance address. For example; in case of the DIKSHA platform, currently it is <a href="https://www.ntp.in">https://www.ntp.in</a></p>
  </li>
  <li>
    <p><strong>nbf:</strong> not before. This indicates the earliest time when the token can be used. It is expressed as the number of seconds since epoch in GMT. The nbf time cannot be in the future</p>
  </li>
  <li>
    <p><strong>exp:</strong> expires. The timestamp when the token expires. It is expressed as the number of seconds since epoch in GMT. The expiry time cannot be more than 600 seconds after the nbf time.</p>
  </li>
  <li>
    <p><strong>name:</strong> The name of the person whose user ID is in the subject</p>
  </li>
  <li>
    <p><strong>email:</strong> The email ID of the person whose user ID is in the subject</p>
  </li>
  <li>
    <p><strong>email_verified:</strong> An indicator whether the email ID has been verified. This is important when only verified user email IDs are accepted on an instance. For example; only verified emails are accepted on DIKSHA</p>
  </li>
  <li>
    <p><strong>phone_number:</strong> The 10 digit phone number of the person whose user ID is in the subject. This is an optional field</p>
  </li>
  <li>
    <p><strong>phone_number_verified:</strong> An indicator whether the phone number has been verified. This is important when only verified user phone numbers are accepted on an instance. For example; only verified phone numbers are accepted on DIKSHA. This field is optional</p>
  </li>
  <li>
    <p><strong>redirect_url:</strong> the url of the page where the user should be directed after login</p>
  </li>
</ul>

<p><strong>Sample Payload for Single Sign-On</strong></p>

<pre>
  {
  "jti": "261263cd-3a0e-4aee-8faf-6d9d9eb14bb1",

  "iss": "replace with id provided by at registration time",

  "sub": "someuserid",

  "aud": "base_url",

  "iat": 1498556656,

  "exp": 1498560256,

  "name": "Some User",

  "email": "some.user@gmail.com",

  "email_verified": true,

  "phone_number": "+91.9555-999-555",

  "phone_number_verified": true,

  "redirect_uri": "base_url/private/index#!/workspace/content/create"
}
</pre>

<h3 id="base-url">Base URL</h3>

<p>Provide the base URL for for the instances created. For example;</p>

<ul>
  <li>The base url for DIKSHA staging is https://staging.ntp.net.in</li>
  <li>The base url for DIKSHA production is https://diksha.gov.in</li>
</ul>

<h3 id="signature">Signature</h3>

<p>Sign the payload described before sending it to the authentication endpoint. The JWT specification permits signing via HMAC, RSA or ECDSA algorithms. For this authentication end-point, the only permitted algorithm is RSA signing via a private key. The corresponding public key is provided during registration of the client.</p>

<p><em>For details on creating a RSA-signed JWT in Java, refer to <a href="https://connect2id.com/products/nimbus-jose-jwt/examples/jwt-with-rsa-signature">JWT with RSA Signature</a></em></p>

<h2 id="onboarding-new-tenant-organization-on-sunbird">Onboarding New Tenant Organization on Sunbird</h2>

<p>Sunbird allows creation and configuration of multiple tenant organizations within a single instance:</p>

<ul>
  <li>
    <p>Every tenant organization has a unique channel; i.e. all the activities by users belonging to that tenant organization are tagged with the tenant’s channel ID. For example, on DIKSHA, activities include content creation, content consumption, etc.</p>
  </li>
  <li>
    <p>Tenant organizations have the option to setup a custom home page and configure the logo to be displayed for users who belong to the tenant</p>
  </li>
  <li>
    <p>Tenant organizations can create multiple sub-organizations and add users to those organizations. For example, on DIKSHA, each state is a tenant on Sunbird and all schools or institutes in that state are created as sub-organizations under that tenant organization.</p>
  </li>
</ul>

<h2 id="generating-rsa-private-and-public-key-pair">Generating RSA Private and Public Key Pair</h2>

<p>To create a new pair of public/private keys, run the following command:</p>

<pre>
{
$ openssl genrsa -out private.pem 2048
}
</pre>

<p>This private key must be kept secret. To generate a public key corresponding to the private key, execute:</p>

<pre>
{
$ openssl rsa -in private.pem -outform PEM -pubout -out public.pem
}
</pre>

<p>On running these commands, the public key is written in <strong>public.pem</strong>, while the private key is written in <strong>private.pem</strong></p>

<h2 id="accessing-apis-using-token">Accessing APIs Using Token</h2>

<p>To access APIs using the token, the generated token should be sent in the Authorization header of the request with the value: bearer <token>. For example; curl request</token></p>

<p><code>curl -H "Authorization: Bearer &lt;token&gt;" https://staging.ntp.net.in/api/echo/hello</code></p>

<h2 id="custom-homepage-and-logo-for-tenants">Custom Homepage and Logo for Tenants</h2>

<p>Sunbird allows you to override the default home page and configure a custom home page and logo for each tenant who is onboarded. The tenant organization should provide a package containing the following files to customise the home page and logo:</p>

<ul>
  <li>
    <p>The home page html file - named as <strong>index.html</strong>. All the dependent files, like js, css and images, used by the home page should be within the package and referred using relative paths from the “index.html”.</p>
  </li>
  <li>
    <p>Logo of the tenant - named as <strong>logo.png</strong></p>
  </li>
  <li>
    <p>Tenants also have an option to configure the following:</p>

    <ul>
      <li>
        <p>an icon - to be displayed as browser favicon, named as <strong>favicon.ico</strong></p>
      </li>
      <li>
        <p>a poster image - to be used as a flash screen in the mobile app, named as <strong>poster.png</strong></p>
      </li>
    </ul>
  </li>
</ul>

<p>Place all the files in a single folder, with the same name as the channel value of the tenant organization</p>

<h2 id="sign-in-link-from-custom-home-page">Sign In link from Custom Home Page</h2>

<p>Add the following link at an appropriate place in the custom home page to invoke Sunbird portal login:</p>

<pre>href="/private/index" title="Sign In"&gt;<span>Sign In</span></pre>

