<h2 id="procedure-to-onboard-organizations">Procedure to Onboard Organizations</h2>

<ol>
  <li>
    <p>Create tenant organization</p>
  </li>
  <li>
    <p>Generate RSA private and public key pair</p>
  </li>
  <li>
    <p>Get public key registered in production</p>
  </li>
  <li>
    <p>Create organizations, and users, and register</p>
  </li>
  <li>
    <p>Single-Sign-On with Sunbird</p>
  </li>
</ol>

<h3 id="tokens">Tokens</h3>

<p>To authenticate with DIKSHA via SSO (Single Sign-on), a JWT provided to the auto-login endpoint must contain the following fields (also known as claims) in its payload.</p>

<ul>
  <li>
    <p>jti: a unique id of the token, can be any string generated by the sender which is unique</p>
  </li>
  <li>
    <p>iss: the issuer of the JWT, this must be the id of the registered client</p>
  </li>
  <li>
    <p>sub: the subject of the token, this must be the user id of the person who will be log in on DIKSHA</p>
  </li>
  <li>
    <p>aud: the consumer of the token, for now this is <a href="https://www.ntp.in">https://www.ntp.in</a></p>
  </li>
  <li>
    <p>nbf: not before, the earliest time when the token can be used (expressed as the number of seconds since epoch in GMT). The nbf time cannot be in the future</p>
  </li>
  <li>
    <p>exp: expires, the timestamp at which the token expires (expressed as the number of seconds since epoch in GMT). The exp time cannot be more than 600 seconds after the nbf time</p>
  </li>
  <li>
    <p>name: the name of the person whose user id is in sub</p>
  </li>
  <li>
    <p>email: the email of the person whose user id is in sub</p>
  </li>
  <li>
    <p>email_verified: whether the email id has been verified. Only Verified emails are accepted on DIKSHA</p>
  </li>
  <li>
    <p>phone_number: 10-digit phone number of the person whose user id is in sub. This field is optional</p>
  </li>
  <li>
    <p>phone_number_verified: whether the phone number has been verified. Only Verified emails are accepted on DIKSHA. This field is optional</p>
  </li>
  <li>
    <p>redirect_uri: the url of the page where the user should be directed after login
 Example Payload for Single-Sign-On</p>
  </li>
</ul>

<pre>
{
  {
  "jti": "261263cd-3a0e-4aee-8faf-6d9d9eb14bb1",

  "iss": "<replace with="" provided="" by="" at="" registration="" time="">",

  "sub": "someuserid",

  "aud": "<base_url>",

  "iat": 1498556656,

  "exp": 1498560256,

  "name": "Some User",

  "email": "some.user@gmail.com",

  "email_verified": true,

  "phone_number": "+91.9555-999-555",

  "phone_number_verified": true,

  "redirect_uri": "<base_url>/private/index#!/workspace/content/create"
}
&lt;/pre&gt;

#### Base Url

The base url for NTP staging will be https://staging.ntp.net.in

The base url for NTP production will be https://diksha.gov.in

#### Signature

The payload described must be signed before sending it the authentication endpoint. The JWT specification permits signing via HMAC, RSA or ECDSA algorithms. For this authentication end-point, the only permitted algorithm will be RSA signing via a private key. The corresponding public key will be provided during registration of the client. 

To read further on creating a RSA-signed JWT in Java see: [https://connect2id.com/products/nimbus-jose-jwt/examples/jwt-with-rsa-signature](https://connect2id.com/products/nimbus-jose-jwt/examples/jwt-with-rsa-signature))

### Onboarding New Tenant Organization on Sunbird

Sunbird allows creation and configuration of multiple tenant organizations in a single instance:

* Every tenant organization has a unique channel, i.e. all the activities by users belonging to that tenant organization are tagged by the tenant's channel id (activities include content creation, content consumption, etc)

* Tenant organizations have the option to setup a custom home page and configure the logo to be displayed for users who belong to the tenant

* Tenant organizations can create multiple sub organizations and add users to those organizations

Example: Each state is a tenant on Sunbird and all schools/institutes in that state are created as sub-organizations under that tenant organization.

### Generating RSA Private and Public Key Pair

To create a new pair of public/private keys, run the following command:

<pre>
{
$ openssl genrsa -out private.pem 2048
}
</pre>

This private key must be kept secret. To generate a public key corresponding to the private key, execute:

<pre>
{
$ openssl rsa -in private.pem -outform PEM -pubout -out public.pem
}
</pre>

If you run these commands, the public key will be written in public.pem, while the private key will be written in private.pem

### Accessing the APIs Using Token

The token generated should be sent in Authorization header of the request with value bearer <token>. Example curl request

curl -H "Authorization: Bearer <token>" https://staging.ntp.net.in/api/echo/hello

### Custom Homepage &amp; Logo for Tenants

Sunbird supports over-riding of default home page and configuring a custom home page and logo for each on-boarded tenant. The tenant organization should provide package containing the following files for customising the home page and logo:

* The home page html file should be named index.html. All the dependent files (like js, css and images) used by the home page should be within the package and referred using relative paths from the "index.html".

* Logo of the tenant which should be with the name "logo.png"

* Optionally, tenants can also configure the following:

    * an icon (to be displayed as browser favicon) which should be named as "favicon.ico"

    * a poster image (to be used as flash screen in the mobile app) which should be named as "poster.png"

All the files should be placed in a folder. The folder name should be the same as the channel value of the tenant organization.

### Sign In link from Custom Home Page

Following link needs to be added at an appropriate place in the custom home page to invoke Sunbird portal login:
<a href="/private/index" title="Sign In"><span>Sign In</span></a>


</token></token></base_url></base_url></replace></pre>
