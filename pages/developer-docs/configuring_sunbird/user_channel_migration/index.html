<h2 id="overview">Overview</h2>
<p>Sunbird, from its release version 1.7 onwards, captures the channel details of the tenant organization for all users in the channel column of user table in cassandra database. Users onboarded prior to this release version will not have channel values, and thus to ensure data consistency across users, this migration has to be done to set the channel value for all the existing users based on their root organisation ID.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To run the migration script, ensure you have:</p>

<ol>
  <li>Access to cassandra database</li>
  <li>A backup of sunbird keyspace in Cassandra DB.</li>
</ol>

<h2 id="configuration-parameters">Configuration Parameters</h2>
<p>The following parameters needs to be passed as arguments for the channel value migration job</p>

<table>
  <thead>
    <tr>
      <th>S.No.</th>
      <th>Parameter</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>sunbird_cassandra_server</td>
      <td>Cassandra DB IP Address</td>
      <td>198.168.1.1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>sunbird_cassandra_port</td>
      <td>Cassandra DB Port Number</td>
      <td>9042</td>
    </tr>
    <tr>
      <td>3</td>
      <td>sunbird_cassandra_username*</td>
      <td>Cassandra DB User Name</td>
      <td>username</td>
    </tr>
    <tr>
      <td>4</td>
      <td>sunbird_cassandra_password*</td>
      <td>Cassandra DB Password</td>
      <td>password</td>
    </tr>
    <tr>
      <td>5</td>
      <td>sunbird_cassandra_keyspace</td>
      <td>Cassandra DB Keyspace Name</td>
      <td>demodb</td>
    </tr>
    <tr>
      <td>6</td>
      <td>sunbird_channel_migration_log_file</td>
      <td>Path to CSV file where migration logs are stored</td>
      <td>\home\channel_migration_log.csv</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Note: If authentication is not required, pass <code>""</code> for parameters, username, and password</p>
</blockquote>

<h2 id="migration-script">Migration Script</h2>

<p>To migrate channel value for the users:</p>

<ol>
  <li>
    <p>Extract the archive file (sunbird-utils/cassandra-migration-etl/r1.7/UserMigrationUpdateChannelBin.zip) that contains the script for channel value migration</p>
  </li>
  <li>
    <p>Run the following command to migrate the data</p>
  </li>
</ol>
<pre> 
UserMigrationUpdateChannel_run.sh --context_param sunbird_cassandra_server="{sunbird_cassandra_server}" 0--context_param sunbird_cassandra_port="{sunbird_cassandra_port}" --context_param sunbird_cassandra_username="{sunbird_cassandra_username}" --context_param sunbird_cassandra_password="{sunbird_cassandra_password}" --context_param sunbird_cassandra_keyspace="{sunbird_cassandra_keyspace}" --context_param sunbird_channel_migration_log_file="{sunbird_channel_migration_log_file}"
</pre>
<ol>
  <li>
    <p>On successful migration, the log is available in the configured file {sunbird_channel_migration_log_file}</p>
  </li>
  <li>
    <p>To cross-check whether all users have channel value, the following queries can be used</p>
  </li>
</ol>

<ul>
  <li>Query to fetch number of users
  <code>select count(*) from user;</code></li>
  <li>Query to fetch number of users with channel value
  <code>select count(channel) from user;</code></li>
</ul>

